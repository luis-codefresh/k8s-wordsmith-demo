version: '1.0'
steps:

  convertCommiterSlackName:
    title: convert from commiter to slack mention
    image: bash
    commands:
      - bash -c 'declare -A SLACK_MAPPING=([web-flow]=UGC3HT1AN [francisco-codefresh]=UAV425A95) && cf_export SLACK_MENTION=${SLACK_MAPPING[$CF_COMMIT_AUTHOR]}'
      - echo "commiter is $CF_COMMIT_AUTHOR"

  SendSlackMessage:
    title: Send slack messge
    image: cloudposse/slack-notifier
    environment:
    - SLACK_WEBHOOK_URL="${{SLACK_WEBHOOK_URL}}"
    - SLACK_USER_NAME='Codefresh Syntax Test'
    - SLACK_ICON_EMOJI=":eyes:"
    - "SLACK_PRETEXT=The RUN_TEST selenium tests has finished running in codefresh for branch ${{CF_BRANCH}}. \nThis is the build: ${{CF_BUILD_URL}}. \nThis is the report: https://s3.amazonaws.com/hb-build-artifacts/codefresh/selenium/RUN_TEST/my-report.html \nThe Build have RUN_TEST. \nBuild link formatting <${{CF_BUILD_URL}}|Build Link> \ncommiter: <@${{SLACK_MENTION}}>"
    - 'SLACK_ATTACHMENTS=[{"actions": [{"type": "button", "style":"primary", "text": "View Test Results Here","url": "https://s3.amazonaws.com/hb-build-artifacts/codefresh/selenium/RUN_TEST/my-report.html"}]}]'
    
